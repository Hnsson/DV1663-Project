<!-- post.html -->
<link rel="stylesheet" href="css/post.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/4c4ab264c0.js" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>

<div class="container">
    <div class="row mt-n5">
        <div class="col-md-6 col-lg-4 mt-5 wow fadeInUp" data-wow-delay=".6s" style="visibility: visible; animation-delay: 0.6s; animation-name: fadeInUp;">
            <div class="blog-grid">
                <div class="blog-grid-img position-relative"><img alt="img" src="https://www.bootdey.com/image/480x480/00FFFF/000000"></div>
                <div class="blog-grid-text p-4">
                    <h3 class="h5 mb-3"><a href="/user/{{ post.username }}/post/{{ post.post_id }}">{{ post.title }}</a></h3>
                    <p class="display-30">{{ post.body }}</p>
                    <div class="meta meta-style2">
                        <ul>
                            <li><i class="fas fa-calendar-alt"></i> {{ post.created_at }}</li><br>
                            <li><a href="/user/{{ post.username }}"> {{ post.name }} - {{ post.username }}</a></li>
                            <li><i class="fas fa-comments"></i> {{ post.comment_count }}</li>
                            <li>
                                <i class="fas heart {% if post.is_liked %}is-active{% endif %}" 
                                data-is-liked="{{ post.is_liked }}" 
                                onclick="likePost('{{ post.post_id }}', {{ post.is_liked }}, this)">
                                    {{ post.like_count }}
                                </i>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function likePost(postId, isLiked, clickedElement) {
        // Toggle 'is-active' class on the clicked heart icon
        $(clickedElement).toggleClass("is-active");
        // Get the current like status from the data attribute
        var currentLikeStatus = $(clickedElement).data("is-liked");
        var newLikeStatus = !currentLikeStatus;
        // Set the new like status to the data attribute for next click
        $(clickedElement).data("is-liked", newLikeStatus);
        // Determine the action based on the new like status
        var action = newLikeStatus ? 'like' : 'unlike';
        var url = "/like/" + postId + "/" + action;

        // Send an AJAX request to handle the like/unlike action
        $.ajax({
            url: url,
            type: 'POST',
            success: function(data) {
                if (data.success) {
                    // Update the like count displayed next to the button
                    var likeCountElement = $(clickedElement);
                    var likeCount = parseInt(likeCountElement.text());
                    likeCount = newLikeStatus ? likeCount + 1 : likeCount - 1;
                    likeCountElement.text(likeCount);
                }
            }
        });
    }
</script>



